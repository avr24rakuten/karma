...:: Utils For Docker 

docker create network karma_network

docker volume rm karma_shared_volume
docker volume create --driver local --opt type=none --opt device=~/karma/shared/ --opt o=bind karma_shared_volume



...:: Image karma_db


docker build -f docker/karma_db/Dockerfile.prod -t karma_db .
docker build -f docker/karma_db/Dockerfile.int -t karma_db .


# ProdSSWORD DANS LE DOCKERFILE POUR LE MOMENT
# docker run -d --name karma_db -e MYSQL_ROOT_PASSWORD=root_prod karma_db

docker run --network=karma_network -d --name karma_db karma_db
docker exec -it karma_db bash


docker container stop karma_db
docker container rm karma_db



...:: Reboot Image DB Int

docker container rm karma_db
docker image rm karma_db
docker build -f docker/karma_db/Dockerfile.int -t karma_db .
docker run --network=karma_network -d --name karma_db karma_db
docker exec -it karma_db bash

...:: Reboot Image DB Prod

docker container rm karma_db
docker image rm karma_db
docker build -f docker/karma_db/Dockerfile.prod -t karma_db .
docker run --network=karma_network -d --name karma_db karma_db


...:: Reboot Image API Int
# !!!! Version sans SECRET_JWT_KEY
docker build -f docker/karma_api/Dockerfile.int -t karma_api .

docker container rm karma_api
docker image rm karma_api
docker build --build-arg SECRET_JWT_KEY=$(grep SECRET_JWT_KEY ~/karma/ignore/secret.env | cut -d '=' -f2) -f docker/karma_api/Dockerfile.int -t karma_api .
docker run -p 8000:8000 -v karma_shared_volume:/app/shared --network=karma_network -d --name karma_api karma_api
docker exec -it karma_api bash


...:: Reboot Image Model Int

docker container rm karma_model
docker image rm karma_model
docker build -f docker/karma_model/Dockerfile.int -t karma_model .
docker run -v karma_shared_volume:/app/shared --network=karma_network -d --name karma_model karma_model
docker exec -it karma_model bash



...:: Reboot Image TEST INF

docker container rm karma_test_int
docker image rm karma_test_int
docker build -f docker/karma_test_int/Dockerfile -t karma_test_int .
docker run -d --name karma_test_int karma_test_int
docker exec -it karma_test_int bash




...:: PUSH ON Dockerhub Image karma_base

#docker container rm karma_base
#docker image rm karma_base
docker build -f docker/karma_base/Dockerfile -t karma_base .
docker run -d --name karma_base karma_base
#docker exec -it karma_test_int bash





...:: LAUNCH API containers

docker network create karma_network

docker run --network=karma_network -d --name karma_db karma_db

docker build -f docker/karma_api/Dockerfile.int -t karma_api .
docker run -p 8000:8000 --network=karma_network -d --name karma_api karma_api


### LAUCNH TESTS PYTEST

docker exec -it karma_api bash -c "python3 -m pytest test_rakuten_api.py"

docker exec -it karma_api bash
python3 -m pytest test_rakuten_api.py




docker-compose -f docker/docker-compose-karma-int.yml down



#########################################
# DOCKER HUB SECTION
#########################################

docker login
# Taggez et poussez l'image karma_api
docker tag karma_api:latest avr24rakuten/karma:karma_api
docker push avr24rakuten/karma:karma_api

# Taggez et poussez l'image karma_db
docker tag karma_db:latest avr24rakuten/karma:karma_db
docker push avr24rakuten/karma:karma_db

# Taggez et poussez l'image karma_model
docker tag karma_model:latest avr24rakuten/karma:karma_model
docker push avr24rakuten/karma:karma_model

# Taggez et poussez l'image karma_base
docker tag karma_base:latest avr24rakuten/karma:karma_base
docker push avr24rakuten/karma:karma_base



POUR SUPPRIMER UN TAG : docker rmi avr24rakuten/karma:latest



############################################
# SSH ON LOCAL UBUNTU WSL2 FOR REMOTE ACCESS
############################################


sudo apt-get update
sudo apt-get install openssh-server

sudo nano /etc/ssh/sshd_config
#Check if :
PermitRootLogin no
PasswordAuthentication yes

sudo service ssh start
# For start at host start 
echo "sudo service ssh start" >> ~/.bashrc

ip addr 
OU hostname -I
172.26.107.175

sudo adduser karma because #root user prohibited
ssh karma@172.26.107.175
netuk@r_42rv@

#Change user and get home
su karma
cd ~

ssh-keygen -t rsa -b 4096 -C "avr24.rakuten@gmail.com"

# Ajouter la clé à ssh-agent
eval "$(ssh-agent -s)"
ssh-add ~/.ssh/id_rsa.pub


############################################
# GIT UTILS
############################################

